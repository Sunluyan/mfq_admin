<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mfq.admin.web.dao.UserQuotaMapper">
	<sql id="selectsql">
		uid, realname, school, contact, grade, classes, startschool_at as
		startschoolAt, 
		school_location_id as schoolLocationId, origin,
		school_location as schoolLocation, student_id as studentId,speciality ,faculty,school_remark as schoolRemark,school_level as schoolLevel,
		
		homesite, id_card as idCard, idcard_reverse as idCardReverse,idcard_front as idCardFront,
		balance, present, quota_all as quotaAll,quota_left as quotaLeft,
		
		company , work_remark as workRemark , work_years as workYears ,social_insurance_id as socialInsuranceId,
		salary , user_type as userType,
		
		auth_status as authStatus, wish_plastic as wishPlastic, school_remark as schoolRemark, created_at as createdAt, updated_at as updatedAt
	</sql>
<!-- 
long uid; // 帐户ID
    String realname; // 真实姓名
    String contact; // 联系电话
    
    String school; // 学校
    Grade grade; // 学历－年级
    String classes; // 班级
    Date startschoolAt; // 毕业时间
    int schoolLocationId; // 学校所在地区ID
    String schoolLocation; // 学校地址
    String studentId; // 学号
    String speciality; // 专业
    String faculty;	//院系
    String schoolRemark;//学生备注
    String schoolLevel;	//学生层次 （即学历，如本科，大专...）
    
    String homesite; // 主页
    
    String idCard; // 身份证号
    String idCardReverse;//身份证背面照片
    String idCardFront;	//身份证正面照片
    BigDecimal balance; // 帐户余额
    BigDecimal present; // 赠送金额-要区分是微信赠送还是充值赠送，假如是活动充值赠送则等同现金，微信赠送部分需要判断订单金额才可使用
    BigDecimal quotaAll; // 信用总额度
    BigDecimal quotaLeft; // 剩余额度
    String company;	//公司名称
    String workRemark; // 上班族备注
    String workYears;	//工作年限
    String socialInsuranceId;	//社保号
    String salary;	//工资范围
    
    int userType;	//用户类型 上班族或者学生
    int wishPlastic; // 是否意愿微整形
    int authStatus; // 认证状态 0-未认证 1-已认证 2-认证中
    Date createdAt; // 创建额度时间
    Date updatedAt; // 更新额度时间

 -->
	<sql id="insertsql">
		uid, realname, school, contact, grade, classes, startschool_at, school_location_id,
		school_location, homesite, id_card, balance, present,
		auth_status, quota_all, quota_left, wish_plastic, school_remark, created_at, updated_at
	</sql>

	<select id="queryUserQuota" resultType="UserQuota">
		select
		<include refid="selectsql" />
		from users_quota where uid=#{uid}
	</select>
	
	
	<select id="queryCertifyQuota" resultType = "map">
		select 
		
		quota.uid , u.nick , quota.realname , u.mobile , quota.contact , u.origin,
		quota.id_card , u.origin ,quota.school_location as location , quota.idcard_reverse , quota.idcard_front
		
		from users_quota quota, users u
		
		where u.uid = quota.uid
		
		and quota.uid = #{uid}
	</select>
	

	<insert id="insertUserQuota" parameterType="UserQuota">
		insert into users_quota(
		<include refid="insertsql" />
		)values (
		#{uid}, #{realname}, #{school}, #{contact}, #{grade}, #{classes}, #{graduatedAt},
		#{locationId}, #{location}, #{homesite},
		#{idCard}, #{balance},
		#{present}, #{authStatus}, #{quotaAll}, #{quotaLeft}, #{wishPlastic},
		#{remark}, now(), now()
		)
	</insert>

	<update id="updateUserBalance" parameterType="UserQuota">
		update users_quota
		set balance=balance+#{num} where uid=#{uid} and balance=#{balance}
	</update>

	<update id="updateUserPresent" parameterType="UserQuota">
		update users_quota
		set present=present+#{num} where uid=#{uid} and present=#{present}
	</update>

	<update id="updateUserWish">
		update users_quota set wish_plastic=#{wish} where
		uid=#{uid}
	</update>

	<update id="updateUserQuota" parameterType="UserQuota">
		update users_quota
		set uid=#{uid}, realname=#{realname}, school=#{school},
		contact=#{contact},
		startschool_at=#{startschoolAt}, id_card=#{idCard}, balance=#{balance}, present=#{present},
		quota_all=#{quotaAll}, quota_left=#{quotaLeft}, auth_status=#{authStatus},
		created_at=#{createdAt},
		updated_at=#{updatedAt} where uid=#{uid}
	</update>
	
	<update id="updateAuthStatus" parameterType="UserQuota">
		update users_quota 
		set auth_status = #{status} 
		<if test = "remark != null and remark != ''">
			, school_remark = #{remark}
		</if>
		where uid = #{uid}
	</update>

</mapper>