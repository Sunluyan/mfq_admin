<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mfq.admin.web.dao.UserMapper">
	<sql id="selectsql">
		uid, status, nick, email, mobile, gender, location, icon, img, pic, 
		birthday, intro, interest, career, created_at as createdAt, 
		updated_at as updatedAt, sign
	</sql>
	<resultMap id="BaseResultMap" type="com.mfq.admin.web.models.user.User">
    <id column="uid" jdbcType="BIGINT" property="uid" />
    <result column="status" jdbcType="TINYINT" property="status" />
    <result column="nick" jdbcType="VARCHAR" property="nick" />
    <result column="email" jdbcType="VARCHAR" property="email" />
    <result column="mobile" jdbcType="VARCHAR" property="mobile" />
    <result column="gender" jdbcType="TINYINT" property="gender" />
    <result column="icon" jdbcType="VARCHAR" property="icon" />
    <result column="img" jdbcType="VARCHAR" property="img" />
    <result column="pic" jdbcType="VARCHAR" property="pic" />
    <result column="location_id" jdbcType="INTEGER" property="locationId" />
    <result column="location" jdbcType="VARCHAR" property="location" />
    <result column="birthday" jdbcType="INTEGER" property="birthday" />
    <result column="intro" jdbcType="VARCHAR" property="intro" />
    <result column="interest" jdbcType="VARCHAR" property="interest" />
    <result column="homesite" jdbcType="VARCHAR" property="homesite" />
    <result column="career" jdbcType="VARCHAR" property="career" />
    <result column="realname" jdbcType="VARCHAR" property="realname" />
    <result column="created_at" jdbcType="TIMESTAMP" property="createdAt" />
    <result column="updated_at" jdbcType="TIMESTAMP" property="updatedAt" />
    <result column="sign" jdbcType="INTEGER" property="sign" />
  </resultMap>
  
  <sql id="Base_Column_List">
    uid, status, nick, email, mobile, gender, icon, img, pic, location_id, location, 
    birthday, intro, interest, homesite, career, realname, created_at as CreatedAt, updated_at, sign
  </sql>
	
	<sql id="insertsql">
		status, nick, email, mobile, gender, icon, img, pic,
		birthday, intro, interest, career, created_at, updated_at, sign
	</sql>
	
	
	
  
  
  

	<select id="queryUserByMobile" resultMap="BaseResultMap">
		select
		<include refid="selectsql" />
		from users where mobile=#{mobile}
	</select>
	
	<select id="queryUser" resultType="User">
		select
		<include refid="selectsql" />
		from users where uid=#{id}
	</select>
	
	<select id="queryUsers" resultType="User">
		select
		<include refid="selectsql" />
		from users where uid in 
		<foreach collection="list" open="(" separator="," close=")"
			item="id">
			#{id}
		</foreach>
	</select>
	
	<select id="queryAllMobiles">
		select mobiles from users
	</select>
	
	<select id="queryMobilesByPage" resultType="map" parameterType="map">
	
		select 
		<if test = "count!=null and count != ''">
			count(*) as total
		</if>
		
		<if test = "count==null or count == ''">
			u.uid,u.mobile,u.nick,quota.realname,u.gender,quota.auth_status,extend.invite_code,u.created_at as createdAt
		</if>
		
		
		from  
		users u 
		left join users_quota quota on quota.uid = u.uid
		left join users_extend extend on extend.uid = quota.uid
		
		where 1=1 
		<if test="phone != null and phone.length() > 1">
			and mobile like CONCAT('%',#{phone},'%')
		</if>
		
		<if test="username != null and username != ''">
			and u.nick like CONCAT('%',#{username},'%')
		</if>
		
		<if test="realname != null and realname != ''">
			and quota.realname like CONCAT('%',#{realname},'%')
		</if>
		
		<if test="status != null and status != '' ">
				and quota.auth_status = #{status}
		</if>
		
		<if test="inviteid != null and inviteid != ''">
			and extend.invite_code = #{inviteid}
		</if>
		
		<!-- alipay TODO -->
		
		<if test="fromtime != null and fromtime != '' and totime != null and totime != ''">
			<![CDATA[
			and u.created_at > #{fromtime} and u.created_at < #{totime}
			]]>
		</if>
		
		
		<if test = "count==null or count == ''">
			LIMIT #{start},#{size}
		</if>
		
	</select>
	
	
		
	<select id="queryUserCount" resultType="long">
		select count(*) from users
	</select>
	
	<select id="queryUserByPage" resultType="User">
		select
		<include refid="selectsql"/>
		from users 
		where 1=1
		LIMIT #{start},#{size}
	</select>
	
	
	<!-- 
		Integer start 
	  	Integer pagesize
    	String type = request.getParameter("type");
    	String uid = request.getParameter("uid");
    	String phone = request.getParameter("phone");
    	String cardid = request.getParameter("cardid");
    	String applytimefrom = request.getParameter("applytimefrom");
    	String applytimeto = request.getParameter("applytimeto");
    	String checktimefrom = request.getParameter("checktimefrom");
    	String checktimeto = request.getParameter("checktimeto")
	 -->
	<select id="queryCertify" resultType="map">
		select 
		<if test = "count != null and count != ''">
			count(quota.uid) as count
		</if>
		
		<if test = "count == null or count == ''">
			quota.uid  ,  quota.created_at as createtime  ,  quota.updated_at as updatetime  ,
			   u.mobile  ,  quota.realname  ,  quota.id_card as cardid , quota.auth_status  ,quota.school_remark
		</if>
		
		
		from users_quota quota,users u
		
		where quota.uid = u.uid
		
		
		<if test = 'type != null and type == "unsee" '>
			and quota.auth_status = 1
		</if>
		
		<if test = 'type != null and type == "pass" '>
			and quota.auth_status = 2
		</if>
		
		<if test = 'type != null and type == "out" '>
			and quota.auth_status = -2
		</if>
		
		<if test = "uid != null and uid != '' ">
			and quota.uid like CONCAT('%',#{uid},'%')
		</if>
		
		<if test = "phone != null and phone != '' ">
			and u.mobile like CONCAT('%',#{phone},'%')
		</if>
		
		<if test = "cardid != null and cardid != '' ">
			and quota.id_card like CONCAT('%',#{cardid},'%')
		</if>
		
		<if test = "cardid != null and cardid != '' ">
			and quota.id_card like CONCAT('%',#{cardid},'%')
		</if>
		
		<if test = "applytimefrom != null and applytimefrom != '' and applytimeto != null and applytimeto != ''">
			<![CDATA[
				and quota.created_at > #{applytimefrom} and quota.created_at < #{applytimeto}
			]]>
		</if>
		
		<if test = "checktimefrom != null and checktimefrom != '' and checktimeto != null and checktimeto != ''">
			<![CDATA[
				and quota.updated_at > #{checktimefrom} and quota.updated_at < #{checktimeto}
			]]>
		</if>
		
		<if test = "count == null or count == ''">
			limit #{start},#{pagesize}
		</if>
		
	</select>
	
	<!-- 
	
用户ID	<uid>	
用户昵称	<user_nickname>
注册手机号	<mobile>	
邀请人手机号	<inviter>
认证状态 <auth_status>	
姓名	<name>	
性别	<sex>	
应急电话	<phone>
身份证号	<id_number>
现住地址	<now_address>
籍贯地址	<befor_address>
身份证照片 <idcard>
	
	
	
	
	 -->
	
	<select id="queryUserDetail" resultType="map">
		select 
		quota.uid , u.nick , u.mobile , quota.auth_status , quota.realname , u.gender,
		quota.contact , quota.id_card , quota.origin , quota.school_location , quota.idcard_reverse , quota.idcard_front 
		
		from users u ,users_quota quota
		
		where quota.uid = u.uid
		and quota.uid = #{uid}
		
	</select>
	

<!-- 
用户ID	1
用户姓名	小张
用户性别	女
出生日期	1992-9-28
联系电话	15210013327
身份证号	4100000000000098
籍贯	河南省平顶山市湛河区
现住址	北京市昌平区
用户类别	学生党/上班族


学生用户学校详细信息

学院名称	学院地址	院系	专业	学号	学制	学校所在地	 入学时间
安阳工学院学院名称	河南安阳	计算机科学与信息工程	软件工程	201203030074	本科	河南安阳	2012-6
上班族用户工作信息

公司名称	月收入	社保号	工作年限	其他

 	
 	
 -->	
	<select id="queryInteviewUserDetail" resultType="map">
		select
		
		quota.uid , quota.realname , u.gender , u.birthday , quota.contact , u.mobile ,  quota.id_card , quota.origin , u.location , quota.user_type ,
		
		quota.school , quota.school_location , quota.faculty , quota.speciality, quota.student_id , quota.school_level , quota.school_location_id, quota.startschool_at
		
		from users u,users_quota quota
		
		where quota.uid = u.uid
		
		and quota.uid = #{uid}
		
	</select>
	
	
	<!-- 
			quota.company , quota.salary , quota.social_insurance_id , quota.work_years , quota.work_remark
	
	 -->
	<insert id="insertInterviewCompany">
		insert into users_quota 
		
		(company,salary,social_insurance_id,work_years,work_remark)
		
		values(#{comname},#{salary},#{insureid},#{workyear},#{remark})
		
		where uid = #{uid}
		
	</insert>
	
	 <update id="updateByPrimaryKeySelective" parameterType="com.mfq.admin.web.models.user.User">
    update users
    <set>
      <if test="status != null">
        status = #{status,jdbcType=TINYINT},
      </if>
      <if test="nick != null">
        nick = #{nick,jdbcType=VARCHAR},
      </if>
      <if test="email != null">
        email = #{email,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null">
        mobile = #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="gender != null">
        gender = #{gender,jdbcType=TINYINT},
      </if>
      <if test="icon != null">
        icon = #{icon,jdbcType=VARCHAR},
      </if>
      <if test="img != null">
        img = #{img,jdbcType=VARCHAR},
      </if>
      <if test="pic != null">
        pic = #{pic,jdbcType=VARCHAR},
      </if>
      <if test="locationId != null">
        location_id = #{locationId,jdbcType=INTEGER},
      </if>
      <if test="location != null">
        location = #{location,jdbcType=VARCHAR},
      </if>
      <if test="birthday != null">
        birthday = #{birthday,jdbcType=INTEGER},
      </if>
      <if test="intro != null">
        intro = #{intro,jdbcType=VARCHAR},
      </if>
      <if test="interest != null">
        interest = #{interest,jdbcType=VARCHAR},
      </if>
      <if test="homesite != null">
        homesite = #{homesite,jdbcType=VARCHAR},
      </if>
      <if test="career != null">
        career = #{career,jdbcType=VARCHAR},
      </if>
      <if test="realname != null">
        realname = #{realname,jdbcType=VARCHAR},
      </if>
      <if test="createdAt != null">
        created_at = #{createdAt,jdbcType=TIMESTAMP},
      </if>
      <if test="updatedAt != null">
        updated_at = #{updatedAt,jdbcType=TIMESTAMP},
      </if>
      <if test="sign != null">
        sign = #{sign,jdbcType=INTEGER},
      </if>
    </set>
    where uid = #{uid,jdbcType=BIGINT}
  </update>
  
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from users
    where uid = #{uid,jdbcType=BIGINT}
  </select>
	
</mapper>















