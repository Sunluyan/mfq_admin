<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mfq.admin.web.dao.ClassifyMapper">
	<sql id="selectsql">
		 id, name, flag, desp, root_id as rootId, icon, hg_image as hgImage
	</sql>

	<sql id="insertsql">
		name, flag, desp, root_id, icon, hg_image
	</sql>

	<select id="findAll" resultType="ProductClassify">
		select
		<include refid="selectsql" />
		from product_classify
	</select>
	
	<select id="findById" resultType="ProductClassify">
		select
		<include refid="selectsql" />
		from product_classify where id=#{id}
	</select>
	
	<select id="findByIdAndRoodId" resultType="ProductClassify">
		select
		<include refid="selectsql"/>
		from product_classify where id=#{id} and root_id=#{rootId}
	</select>

	<select id="findByRootId" resultType="ProductClassify">
		select
		<include refid="selectsql" />
		from product_classify where root_id=#{rootId}
	</select>
	
	<select id="findByLevel" resultType="ProductClassify">
		select
		<include refid="selectsql"/>
		from product_classify where 1=1 
		<if test="rootId == 0">
		and root_id=#{rootId}
		</if>
		<if test="rootId != 0">
		and root_id &lt;&gt; 0
		</if>
	</select>
	
	<select id="findClassIdsByRootId" resultType="long">
		select id from product_classify 
		<if test="rootId != 0">
			where root_id=#{rootId}
		</if>
	</select>

	<insert id="insertOne" parameterType="ProductClassify"
		useGeneratedKeys="true" keyProperty="id">
		<selectKey resultType="int" order="AFTER" keyProperty="id">
			SELECT LAST_INSERT_ID() AS id
		</selectKey>
		insert into product_classify(
		<include refid="insertsql" />
		)values (
		#{name}, #{flag}, #{desp}, #{rootId}, #{icon}, #{hgImage}
		)
	</insert>
	
	<update id="updateClassify">
		update product_classify set name=#{name}, flag=#{flag} ,root_id = #{rootId}
		<if test="hgImage != null and hgImage != ''">
		, hg_image=#{hgImage} 
		</if>
		where id=#{id}
	</update>

	<delete id="delClassify">
		delete from product_classify where id=#{id}
	</delete>
	
	<delete id="delClassifyByRoot">
		delete from product_classify where root_id=#{rid}
	</delete>
</mapper>